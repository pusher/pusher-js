/* SockJS client, http://sockjs.org, MIT License
 *
 * Copyright (c) 2011-2012 VMware, Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

var JSON;JSON||(JSON={});
(function(){function m(d,l){var t,q,o,p,x=k,i,j=l[d];j&&typeof j=="object"&&typeof j.toJSON=="function"&&(j=j.toJSON(d));typeof s=="function"&&(j=s.call(l,d,j));switch(typeof j){case "string":return g(j);case "number":return isFinite(j)?String(j):"null";case "boolean":case "null":return String(j);case "object":if(!j)return"null";k+=w;i=[];if(Object.prototype.toString.apply(j)==="[object Array]"){p=j.length;for(t=0;t<p;t+=1)i[t]=m(t,j)||"null";o=i.length===0?"[]":k?"[\n"+k+i.join(",\n"+k)+"\n"+x+"]":
"["+i.join(",")+"]";k=x;return o}if(s&&typeof s=="object"){p=s.length;for(t=0;t<p;t+=1)typeof s[t]=="string"&&(q=s[t],o=m(q,j),o&&i.push(g(q)+(k?": ":":")+o))}else for(q in j)Object.prototype.hasOwnProperty.call(j,q)&&(o=m(q,j),o&&i.push(g(q)+(k?": ":":")+o));o=i.length===0?"{}":k?"{\n"+k+i.join(",\n"+k)+"\n"+x+"}":"{"+i.join(",")+"}";k=x;return o}}function g(d){l.lastIndex=0;return l.test(d)?'"'+d.replace(l,function(d){var g=G[d];return typeof g=="string"?g:"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+d+'"'}function d(d){return d<10?"0"+d:d}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var p=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k,w,G={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s;typeof JSON.stringify!="function"&&(JSON.stringify=function(d,g,l){var q;k="";w="";if(typeof l=="number")for(q=0;q<l;q+=1)w+=" ";else typeof l=="string"&&(w=l);s=g;if(!g||typeof g=="function"||typeof g=="object"&&typeof g.length=="number")return m("",{"":d});throw Error("JSON.stringify");
});typeof JSON.parse!="function"&&(JSON.parse=function(d,g){function m(d,k){var l,i,j=d[k];if(j&&typeof j=="object")for(l in j)Object.prototype.hasOwnProperty.call(j,l)&&(i=m(j,l),i!==void 0?j[l]=i:delete j[l]);return g.call(d,k,j)}var k;d=String(d);p.lastIndex=0;p.test(d)&&(d=d.replace(p,function(d){return"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(d.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return k=eval("("+d+")"),typeof g=="function"?m({"":k},""):k;throw new SyntaxError("JSON.parse");})})();
var SockJS=function(){var m=document,g=window,d={},p=function(){};p.prototype.addEventListener=function(a,b){if(!this._listeners)this._listeners={};a in this._listeners||(this._listeners[a]=[]);var c=this._listeners[a];d.arrIndexOf(c,b)===-1&&c.push(b)};p.prototype.removeEventListener=function(a,b){if(this._listeners&&a in this._listeners){var c=this._listeners[a],e=d.arrIndexOf(c,b);e!==-1&&(c.length>1?this._listeners[a]=c.slice(0,e).concat(c.slice(e+1)):delete this._listeners[a])}};p.prototype.dispatchEvent=
function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);this["on"+b]&&this["on"+b].apply(this,c);if(this._listeners&&b in this._listeners)for(var e=0;e<this._listeners[b].length;e++)this._listeners[b][e].apply(this,c)};var l=function(a,b){this.type=a;if(typeof b!=="undefined")for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};l.prototype.toString=function(){var a=[],b;for(b in this)if(this.hasOwnProperty(b)){var c=this[b];typeof c==="function"&&(c="[function]");a.push(b+"="+c)}return"SimpleEvent("+
a.join(", ")+")"};var k=function(a){this._events=a||[];this._listeners={}};k.prototype.emit=function(a){this._verifyType(a);if(!this._nuked){var b=Array.prototype.slice.call(arguments,1);this["on"+a]&&this["on"+a].apply(this,b);if(a in this._listeners)for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(this,b)}};k.prototype.on=function(a,b){this._verifyType(a);this._nuked||(a in this._listeners||(this._listeners[a]=[]),this._listeners[a].push(b))};k.prototype._verifyType=function(a){d.arrIndexOf(this._events,
a)===-1&&d.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(this._events)+" in "+this)};k.prototype.nuke=function(){this._nuked=!0;for(var a=0;a<this._events.length;a++)delete this[this._events[a]];this._listeners={}};d.random_string=function(a,b){var b=b||37,c,e=[];for(c=0;c<a;c++)e.push("abcdefghijklmnopqrstuvwxyz0123456789_".substr(Math.floor(Math.random()*b),1));return e.join("")};d.random_number=function(a){return Math.floor(Math.random()*a)};d.random_number_string=function(a){var b=
(""+(a-1)).length;return(Array(b+1).join("0")+d.random_number(a)).slice(-b)};d.getOrigin=function(a){if(a.match(/^file:\/\//))return null;var b=a.match(/^(https?):\/\/([^\/:]+)(:([0-9]+))?/),a=b[1],c=b[2];(b=b[4])||(b=a==="https"?443:80);return a+"://"+c+":"+b};d.isSameOriginUrl=function(a,b){if(!b)b=g.location.href;return d.getOrigin(a)===d.getOrigin(b)};d.getParentDomain=function(a){return/^[0-9.]*$/.test(a)?a:/^\[/.test(a)?a:!/[.]/.test(a)?a:a.split(".").slice(1).join(".")};d.objectExtend=function(a,
b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};d.polluteGlobalNamespace=function(){"_jp"in g||(g._jp={})};d.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])};d.userSetCode=function(a){return a===1E3||a>=3E3&&a<=4999};d.countRTO=function(a){return a>100?3*a:a+200};d.log=function(){g.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)};d.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}};d.flatUrl=function(a){return a.indexOf("?")===
-1&&a.indexOf("#")===-1};d.amendUrl=function(a){var b=m.location;if(!a)throw Error("Wrong url for SockJS");if(!d.flatUrl(a))throw Error("Only basic urls are supported in SockJS");a.indexOf("//")===0&&(a=b.protocol+a);a.indexOf("/")===0&&(a=b.protocol+"//"+b.host+a);return a=a.replace(/[/]+$/,"")};d.arrIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1};d.arrSkip=function(a,b){var c=d.arrIndexOf(a,b);return c===-1?a.slice():a.slice(0,c).concat(a.slice(c+1))};d.isArray=Array.isArray||
function(a){return{}.toString.call(a).indexOf("Array")>=0};d.delay=function(a,b){typeof a==="function"&&(b=a,a=0);return setTimeout(b,a)};var w=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,G={"\x00":"\\u0000","\u0001":"\\u0001","\u0002":"\\u0002","\u0003":"\\u0003","\u0004":"\\u0004","\u0005":"\\u0005","\u0006":"\\u0006","\u0007":"\\u0007","\u0008":"\\b","\t":"\\t","\n":"\\n","\u000b":"\\u000b","\u000c":"\\f","\r":"\\r",
"\u000e":"\\u000e","\u000f":"\\u000f","\u0010":"\\u0010","\u0011":"\\u0011","\u0012":"\\u0012","\u0013":"\\u0013","\u0014":"\\u0014","\u0015":"\\u0015","\u0016":"\\u0016","\u0017":"\\u0017","\u0018":"\\u0018","\u0019":"\\u0019","\u001a":"\\u001a","\u001b":"\\u001b","\u001c":"\\u001c","\u001d":"\\u001d","\u001e":"\\u001e","\u001f":"\\u001f",'"':'\\"',"\\":"\\\\","\u007f":"\\u007f","\u0080":"\\u0080","\u0081":"\\u0081","\u0082":"\\u0082","\u0083":"\\u0083","\u0084":"\\u0084","\u0085":"\\u0085","\u0086":"\\u0086",
"\u0087":"\\u0087","\u0088":"\\u0088","\u0089":"\\u0089","\u008a":"\\u008a","\u008b":"\\u008b","\u008c":"\\u008c","\u008d":"\\u008d","\u008e":"\\u008e","\u008f":"\\u008f","\u0090":"\\u0090","\u0091":"\\u0091","\u0092":"\\u0092","\u0093":"\\u0093","\u0094":"\\u0094","\u0095":"\\u0095","\u0096":"\\u0096","\u0097":"\\u0097","\u0098":"\\u0098","\u0099":"\\u0099","\u009a":"\\u009a","\u009b":"\\u009b","\u009c":"\\u009c","\u009d":"\\u009d","\u009e":"\\u009e","\u009f":"\\u009f","\u00ad":"\\u00ad","\u0600":"\\u0600",
"\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063","\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067",
"\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd","\ufffe":"\\ufffe","\uffff":"\\uffff"},s=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
E,O=JSON&&JSON.stringify||function(a){w.lastIndex=0;w.test(a)&&(a=a.replace(w,function(a){return G[a]}));return'"'+a+'"'},t=function(a){var b,c={},e=[];for(b=0;b<65536;b++)e.push(String.fromCharCode(b));a.lastIndex=0;e.join("").replace(a,function(a){c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);return""});a.lastIndex=0;return c};d.quote=function(a){a=O(a);s.lastIndex=0;if(!s.test(a))return a;E||(E=t(s));return a.replace(s,function(a){return E[a]})};var q="websocket,xdr-streaming,xhr-streaming,iframe-eventsource,iframe-htmlfile,xdr-polling,xhr-polling,iframe-xhr-polling,jsonp-polling".split(",");
d.probeProtocols=function(a){for(var b={},c=0;c<q.length;c++){var e=q[c];b[e]=f[e]&&f[e].enabled(a)}return b};d.detectProtocols=function(a,b,c){var e={},d=[];b||(b=q);for(var z=0;z<b.length;z++){var f=b[z];e[f]=a[f]}var g=function(a){var b=a.shift();e[b]?d.push(b):a.length>0&&g(a)};c.websocket!==!1&&g(["websocket"]);e["xhr-streaming"]&&!c.null_origin?d.push("xhr-streaming"):e["xdr-streaming"]&&!c.cookie_needed&&!c.null_origin?d.push("xdr-streaming"):g(["iframe-eventsource","iframe-htmlfile"]);e["xhr-polling"]&&
!c.null_origin?d.push("xhr-polling"):e["xdr-polling"]&&!c.cookie_needed&&!c.null_origin?d.push("xdr-polling"):g(["iframe-xhr-polling","jsonp-polling"]);return d};d.defaultOptions=function(){return{devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0,max_window_time:4E3,init_window_size:4096}};d.createHook=function(){var a="a"+d.random_string(8);if(!("_sockjs_global"in g)){var b={};g._sockjs_global=function(a){a in b||(b[a]={id:a,del:function(){delete b[a]}});return b[a]}}return g._sockjs_global(a)};
d.attachMessage=function(a){d.attachEvent("message",a)};d.attachEvent=function(a,b){typeof g.addEventListener!=="undefined"?g.addEventListener(a,b,!1):(m.attachEvent("on"+a,b),g.attachEvent("on"+a,b))};d.detachMessage=function(a){d.detachEvent("message",a)};d.detachEvent=function(a,b){typeof g.addEventListener!=="undefined"?g.removeEventListener(a,b,!1):(m.detachEvent("on"+a,b),g.detachEvent("on"+a,b))};var o={},F=!1,x=function(){for(var a in o)o[a](),delete o[a]};d.attachEvent("unload",function(){F||
(F=!0,x())});d.unload_add=function(a){var b=d.random_string(8);o[b]=a;F&&d.delay(x);return b};d.unload_del=function(a){a in o&&delete o[a]};d.createIframe=function(a,b){var c=m.createElement("iframe"),e,h,z=function(){clearTimeout(e);try{c.onload=null}catch(a){}c.onerror=null},f=function(){c&&(z(),setTimeout(function(){c&&c.parentNode.removeChild(c);c=null},0),d.unload_del(h))},g=function(a){c&&(f(),b(a))};c.src=a;c.style.display="none";c.style.position="absolute";c.onerror=function(){g("onerror")};
c.onload=function(){clearTimeout(e);e=setTimeout(function(){g("onload timeout")},2E3)};m.body.appendChild(c);e=setTimeout(function(){g("timeout")},15E3);h=d.unload_add(f);return{post:function(a,b){try{c&&c.contentWindow&&c.contentWindow.postMessage(a,b)}catch(e){}},cleanup:f,loaded:z}};d.createHtmlfile=function(a,b){var c=new ActiveXObject("htmlfile"),e,h,f,i=function(){clearTimeout(e)},j=function(){c&&(i(),d.unload_del(h),f.parentNode.removeChild(f),f=c=null,CollectGarbage())};c.open();c.write('<html><script>document.domain="'+
document.domain+'";<\/script></html>');c.close();c.parentWindow._jp=g._jp;var k=c.createElement("div");c.body.appendChild(k);f=c.createElement("iframe");k.appendChild(f);f.src=a;e=setTimeout(function(){c&&(j(),b("timeout"))},15E3);h=d.unload_add(j);return{post:function(a,b){try{f&&f.contentWindow&&f.contentWindow.postMessage(a,b)}catch(c){}},cleanup:j,loaded:i}};var i=function(){};i.prototype=new k(["chunk","finish"]);i.prototype._start=function(a,b,c,e){var h=this;try{h.xhr=new XMLHttpRequest}catch(f){}if(!h.xhr)try{h.xhr=
new g.ActiveXObject("Microsoft.XMLHTTP")}catch(i){}if(g.ActiveXObject||g.XDomainRequest)b+=(b.indexOf("?")===-1?"?":"&")+"t="+ +new Date;h.unload_ref=d.unload_add(function(){h._cleanup(!0)});try{h.xhr.open(a,b,!0)}catch(j){h.emit("finish",0,"");h._cleanup();return}if(!e||!e.no_credentials)h.xhr.withCredentials="true";if(e&&e.headers)for(var k in e.headers)h.xhr.setRequestHeader(k,e.headers[k]);h.xhr.onreadystatechange=function(){if(h.xhr){var a=h.xhr;switch(a.readyState){case 3:try{var b=a.status,
c=a.responseText}catch(e){}b===1223&&(b=204);c&&c.length>0&&h.emit("chunk",b,c);break;case 4:b=a.status,b===1223&&(b=204),h.emit("finish",b,a.responseText),h._cleanup(!1)}}};h.xhr.send(c)};i.prototype._cleanup=function(a){if(this.xhr){d.unload_del(this.unload_ref);this.xhr.onreadystatechange=function(){};if(a)try{this.xhr.abort()}catch(b){}this.unload_ref=this.xhr=null}};i.prototype.close=function(){this.nuke();this._cleanup(!0)};(d.XHRCorsObject=function(){var a=this,b=arguments;d.delay(function(){a._start.apply(a,
b)})}).prototype=new i;(d.XHRLocalObject=function(a,b,c){var e=this;d.delay(function(){e._start(a,b,c,{no_credentials:!0})})}).prototype=new i;i=d.XDRObject=function(a,b,c){var e=this;d.delay(function(){e._start(a,b,c)})};i.prototype=new k(["chunk","finish"]);i.prototype._start=function(a,b,c){var e=this,h=new XDomainRequest;b+=(b.indexOf("?")===-1?"?":"&")+"t="+ +new Date;var f=h.ontimeout=h.onerror=function(){e.emit("finish",0,"");e._cleanup(!1)};h.onprogress=function(){e.emit("chunk",200,h.responseText)};
h.onload=function(){e.emit("finish",200,h.responseText);e._cleanup(!1)};e.xdr=h;e.unload_ref=d.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(c)}catch(g){f()}};i.prototype._cleanup=function(a){if(this.xdr){d.unload_del(this.unload_ref);this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null;if(a)try{this.xdr.abort()}catch(b){}this.unload_ref=this.xdr=null}};i.prototype.close=function(){this.nuke();this._cleanup(!0)};d.isXHRCorsCapable=function(a){a=a.match(/^(https?:)/)[0];
return g.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:g.XDomainRequest&&m.domain&&m.location.protocol==a?2:r.enabled()?3:4};var j=function(a,b,c){var e=this;d.delay(function(){e._start(a,b,c)})};j.prototype=new k(["finish"]);j.prototype._start=function(a,b,c){var e=this;if(!("_send_form"in c)){var h=c._send_form=m.createElement("form"),f=c._send_area=m.createElement("textarea");f.name="d";h.style.display="none";h.style.position="absolute";h.method="POST";h.enctype="application/x-www-form-urlencoded";
h.acceptCharset="UTF-8";h.appendChild(f);m.body.appendChild(h)}h=c._send_form;f=c._send_area;c="a"+d.random_string(8);e.area=f;h.target=c;h.action=a+"/jsonp_send?i="+c;var g;try{g=m.createElement('<iframe name="'+c+'">')}catch(i){g=m.createElement("iframe"),g.name=c}e.iframe=g;g.id=c;h.appendChild(g);g.style.display="none";try{f.value=b}catch(j){d.log("Your browser is seriously broken. Go home! "+j.message)}h.submit();var k=function(){e.iframe&&(e._cleanup(),e.emit("finish"))};g.onerror=g.onload=
k;g.onreadystatechange=function(){g.readyState=="complete"&&k()}};j.prototype._cleanup=function(){if(this.iframe){var a=this.iframe;this.area.value="";this.iframe.onreadystatechange=this.iframe.onerror=this.iframe.onload=this.area=null;this.iframe="";d.delay(500,function(){a.parentNode.removeChild(a);a=null})}};j.prototype.close=function(){this.nuke();this._cleanup()};var f=function(a,b,c){if(this===g)return new f(a,b,c);var e=this,h;e._options=d.defaultOptions();c&&d.objectExtend(e._options,c);e._base_url=
d.amendUrl(a);e._server=e._options.server||d.random_number_string(1E3);e._bus=new k(["close","heartbeat","message"]);e._options.protocols_whitelist&&e._options.protocols_whitelist.length?h=e._options.protocols_whitelist:(h=typeof b==="string"&&b.length>0?[b]:d.isArray(b)?b:null)&&e._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.');e._protocols=[];e.protocol=null;e.readyState=f.CONNECTING;e._ir=P(e,e._base_url);
e._ir.onfinish=function(a,b){e._ir=null;if(a){e._options.info&&(a=d.objectExtend(a,e._options.info));if(e._options.rtt)b=e._options.rtt;e._applyInfo(a,b,h);e._didClose(void 0,void 0,void 0,"info-onfinish")}else e._didClose(1002,"Can't connect to server",!0,"info-failed")}};f.prototype=new p;f.version="0.3.4.65.g83db";f.CONNECTING=0;f.OPEN=1;f.CLOSING=2;f.CLOSED=3;f.prototype._debug=function(){this._options.debug&&d.log.apply(d,arguments)};f.prototype._dispatchOpen=function(){if(this.readyState===
f.CONNECTING){if(this._transport_tref)clearTimeout(this._transport_tref),this._transport_tref=null;this.readyState=f.OPEN;var a=this._options.info.server_heartbeat_interval;a&&this._startHeartbeats(a);this.dispatchEvent(new l("open"))}else this._didClose(1006,"Server lost session",void 0,"_dispatchOpen")};f.prototype._dispatchMessage=function(a){this.readyState===f.OPEN&&(this._bus.emit("message",a),this.dispatchEvent(new l("message",{data:a})))};f.prototype._dispatchHeartbeat=function(a){this.readyState===
f.OPEN&&(this._bus.emit("heartbeat",a),this.dispatchEvent(new l("heartbeat",{flavour:a})))};f.prototype._didClose=function(a,b,c){var e=this;if(!(e.readyState!==f.CONNECTING&&e.readyState!==f.OPEN&&e.readyState!==f.CLOSING)){if(e._ir)e._ir.nuke(),e._ir=null;if(e._transport)e._transport.doCleanup(),e._transport=null;var h=new l("close",{code:a,reason:b,wasClean:d.userSetCode(a)});if(!d.userSetCode(a)&&e.readyState===f.CONNECTING&&!c){if(e._try_next_protocol(h))return;h=new l("close",{code:2E3,reason:"All transports failed",
wasClean:!1,last_event:h})}e.readyState=f.CLOSED;e._bus.emit("close");d.delay(function(){e.dispatchEvent(h)})}};f.prototype._didMessage=function(a){switch(a.slice(0,1)){case "o":this._dispatchOpen();break;case "a":for(var a=JSON.parse(a.slice(1)||"[]"),b=0;b<a.length;b++)this._dispatchMessage(a[b]);a.length===0&&this._dispatchHeartbeat("recv");break;case "m":a=JSON.parse(a.slice(1)||"null");this._dispatchMessage(a);break;case "c":a=JSON.parse(a.slice(1)||"[]");this._didClose(a[0],a[1],void 0,"_didMessage");
break;case "h":this._dispatchHeartbeat("send")}};f.prototype._try_next_protocol=function(a){var b=this;if(b.protocol)b._debug("Closed transport:",b.protocol,""+a),b.protocol=null;if(b._transport_tref)clearTimeout(b._transport_tref),b._transport_tref=null;for(;;){a=b.protocol=b._protocols.shift();if(!a)return!1;if(f[a]&&f[a].need_body===!0&&(!m.body||typeof m.readyState!=="undefined"&&m.readyState!=="complete"))return b._protocols.unshift(a),b.protocol="waiting-for-load",d.attachEvent("load",function(){b._try_next_protocol()}),
!0;if(!f[a]||!f[a].enabled(b._base_url))b._debug("Skipping transport:",a);else{b._transport_tref=d.delay((b._options.rto||0)*(f[a].roundTrips||1)||5E3,function(){b.readyState===f.CONNECTING&&b._didClose(2007,"Transport timeouted")});var c=d.random_string(8),c=b._base_url+"/"+b._server+"/"+c;b._debug("Opening transport:",a," url:"+c," RTO:"+b._options.rto);b._transport=new f[a](b,c,b._base_url);return!0}}};f.prototype.close=function(a,b){if(a&&!d.userSetCode(a))throw Error("INVALID_ACCESS_ERR");if(this.readyState!==
f.CONNECTING&&this.readyState!==f.OPEN)return!1;this.readyState=f.CLOSING;this._didClose(a||1E3,b||"Normal closure",void 0,"close");return!0};f.prototype.send=function(a){if(this.readyState===f.CONNECTING)throw Error("INVALID_STATE_ERR");this.readyState===f.OPEN&&this._transport.doSend(d.quote(""+a));return!0};f.prototype._sendEmpty=function(){this.readyState===f.OPEN&&this._transport.doSend("");return!0};f.prototype._applyInfo=function(a,b,c){this._options.info=a;this._options.rtt=b;this._options.rto=
d.countRTO(b);this._options.info.null_origin=Boolean(this._options.ignore_null_origin||!m.domain);b=d.probeProtocols(this._base_url);this._protocols=d.detectProtocols(b,c,a);if(a.hostname)c=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(this._base_url),this._base_url=c[1]+a.hostname+c[3]};i=f.websocket=function(a,b){var c=this,e=b+"/websocket",e=e.slice(0,5)==="https"?"wss"+e.slice(5):"ws"+e.slice(4);c.ri=a;c.url=e;c.ws=new (g.WebSocket||g.MozWebSocket)(c.url);c.ws.onmessage=function(a){c.ri._didMessage(a.data)};
c.unload_ref=d.unload_add(function(){c.ws.close()});c.ws.onclose=function(){c.ri._didMessage(d.closeFrame(1006,"WebSocket connection broken"))}};i.prototype.doSend=function(a){this.ws.send("["+a+"]")};i.prototype.doCleanup=function(){var a=this.ws;if(a)a.onmessage=a.onclose=null,a.close(),d.unload_del(this.unload_ref),this.unload_ref=this.ri=this.ws=null};i.enabled=function(){return!(!g.WebSocket&&!g.MozWebSocket)};i.roundTrips=2;var n=function(){};n.prototype.send_constructor=function(a){this.send_buffer=
[];this.sender=a;this.window_size=this.init_window_size=this.ri._options.init_window_size;this.max_window_time=this.ri._options.max_window_time};n.prototype.doSend=function(a){a.length>0&&this.send_buffer.push(a);this.send_stop&&a.length==0&&this.ri._debug("Attempting to send a heartbeat, but sending previous messages is still in progress.");this.send_stop||this.send_schedule()};n.prototype.adjustWindow=function(a,b){if(a>this.max_window_time)return this.window_size=Math.max(this.window_size/2,this.init_window_size),
!0;else if(b)return this.window_size*=a*2<this.max_window_time?2:1.1,!0;return!1};n.prototype.send_schedule_wait=function(){var a=this,b;a.send_stop=function(){a.send_stop=null;clearTimeout(b)};b=d.delay(25,function(){a.send_stop=null;a.send_buffer.length>0&&a.send_schedule()})};n.prototype.send_schedule=function(){var a=this,b=+new Date,c,e=2,d=!1;for(c=0;c<a.send_buffer.length;c++)if(e+=a.send_buffer[c].length+1,e>a.window_size){d=!0;break}c="["+a.send_buffer.splice(0,c).join(",")+"]";a.send_stop=
a.sender(a.trans_url,c,function(c,e){a.send_stop=null;c===!1?a.ri._didClose(1006,"Sending error "+e):(a.adjustWindow(+new Date-b,d)&&a.ri._debug("window_size adjusted: "+a.window_size),a.send_schedule_wait())})};n.prototype.send_destructor=function(){this.send_stop&&this.send_stop();this.send_stop=null};var Q=function(a,b,c){var e=new j(a,b,this);e.onfinish=function(){c(!0)};return function(){e.close()}},R=function(a){return function(b,c,e){var d=new a("POST",b+"/xhr_send",c);d.onfinish=function(a){e(a===
200||a===204,"http status "+a)};return function(){d.close()}}},S=function(a,b){var c,e=m.createElement("script"),h,f=function(a){var z;h&&(h.parentNode.removeChild(h),h=null);if(e)clearTimeout(c),e.parentNode.removeChild(e),z=e.onreadystatechange=e.onerror=e.onload=e.onclick=null,e=z,b(a),b=null},g=!1,i=null;e.id="a"+d.random_string(8);e.src=a;e.type="text/javascript";e.charset="UTF-8";e.onerror=function(){i||(i=setTimeout(function(){g||f(d.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},
1E3))};e.onload=function(){f(d.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};e.onreadystatechange=function(){if(/loaded|closed/.test(e.readyState)){if(e&&e.htmlFor&&e.onclick){g=!0;try{e.onclick()}catch(a){}}e&&f(d.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if(typeof e.async==="undefined"&&m.attachEvent)if(/opera/i.test(navigator.userAgent))h=m.createElement("script"),h.text="try{var a = document.getElementById('"+e.id+"'); if(a)a.onerror();}catch(x){};",
e.async=h.async=!1;else{try{e.htmlFor=e.id,e.event="onclick"}catch(k){}e.async=!0}if(typeof e.async!=="undefined")e.async=!0;c=setTimeout(function(){f(d.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35E3);var j=m.getElementsByTagName("head")[0];j.insertBefore(e,j.firstChild);h&&j.insertBefore(h,j.firstChild);return f},i=f["jsonp-polling"]=function(a,b){d.polluteGlobalNamespace();this.ri=a;this.trans_url=b;this.send_constructor(Q);this._schedule_recv()};i.prototype=new n;i.prototype._schedule_recv=
function(){var a=this;a._recv_stop=T(a.trans_url+"/jsonp",S,function(b){a._recv_stop=null;b&&(a._is_closing||a.ri._didMessage(b));a._is_closing||a._schedule_recv()})};i.enabled=function(){return!0};i.need_body=!0;i.polling=!0;i.prototype.doCleanup=function(){this._is_closing=!0;this._recv_stop&&this._recv_stop();this.ri=this._recv_stop=null;this.send_destructor()};var T=function(a,b,c){var e="a"+d.random_string(6),a=a+"?c="+escape("_jp."+e),h=0,b=b(a,function(a){switch(h){case 0:delete g._jp[e];c(a);
break;case 1:c(a);h=2;break;case 2:delete g._jp[e]}});g._jp[e]=b;return function(){g._jp[e]&&(h=1,g._jp[e](d.closeFrame(1E3,"JSONP user aborted read")))}},i=function(){};i.prototype=new n;i.prototype.run=function(a,b,c,e,d){this.ri=a;this.trans_url=b;this.send_constructor(R(d));this.poll=new H(a,e,b+c,d)};i.prototype.doCleanup=function(){if(this.poll)this.poll.abort(),this.poll=null;this.send_destructor()};var v=f["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",y,d.XHRCorsObject)};v.prototype=
new i;v.enabled=function(){return g.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};v.roundTrips=2;v.need_body=!0;n=f["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",y,d.XDRObject)};n.prototype=new i;n.enabled=function(a){return d.isXHRCorsCapable(a)===2};n.roundTrips=2;var C=f["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",y,d.XHRCorsObject)};C.prototype=new i;C.enabled=v.enabled;C.roundTrips=2;C.polling=!0;v=f["xdr-polling"]=function(a,
b){this.run(a,b,"/xhr",y,d.XDRObject)};v.prototype=new i;v.enabled=n.enabled;v.roundTrips=2;v.polling=!0;var r=function(){};r.prototype.i_constructor=function(a,b,c){var e=this;e.ri=a;e.origin=d.getOrigin(c);e.base_url=c;e.trans_url=b;a=c+"/iframe.html";b=[];e.ri._options.devel&&b.push("t="+ +new Date);e.ri._options.js_path&&b.push("js_path="+encodeURIComponent(e.ri._options.js_path));b.length>0&&(a+="?"+b.join("&"));e.window_id=d.random_string(8);a+="#"+e.window_id;e.iframeObj=d.createIframe(a,function(a){e.ri._didClose(1006,
"Unable to load an iframe ("+a+")")});e.onmessage_cb=d.bind(e.onmessage,e);d.attachMessage(e.onmessage_cb)};r.prototype.doCleanup=function(){if(this.iframeObj){d.detachMessage(this.onmessage_cb);try{this.iframeObj.iframe.contentWindow&&this.postMessage("c")}catch(a){}this.iframeObj.cleanup();this.onmessage_cb=this.iframeObj=this.iframeObj=null}};r.prototype.onmessage=function(a){if(d.getOrigin(a.origin)===d.getOrigin(this.origin)){var b=a.data.slice(0,8),c=a.data.slice(8,9),a=a.data.slice(9);if(b===
this.window_id)switch(c){case "s":this.iframeObj.loaded();this.postMessage("s",JSON.stringify([f.version,this.protocol,this.trans_url,this.base_url,this.ri._options]));break;case "t":this.ri._didMessage(a)}}};r.prototype.postMessage=function(a,b){this.iframeObj.post(this.window_id+a+(b||""),this.origin)};r.prototype.doSend=function(a){this.postMessage("m",a)};r.enabled=function(){var a=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof g.postMessage==="function"||
typeof g.postMessage==="object")&&!a};var I,J=function(a,b){parent!==g?parent.postMessage(I+a+(b||""),"*"):d.log("Can't postMessage, no parent window.",a,b)},u=function(a){this._options=a||d.defaultOptions()};u.prototype._didClose=function(a,b){J("t",d.closeFrame(a,b))};u.prototype._didMessage=function(a){J("t",a)};u.prototype._doSend=function(a){this._transport.doSend(a)};u.prototype._doCleanup=function(){this._transport.doCleanup()};u.prototype._debug=function(){d.log.apply(d,arguments)};d.parent_origin=
void 0;f.bootstrap_iframe=function(){var a;I=m.location.hash.slice(1);d.attachMessage(function(b){if(b.source===parent){if(typeof d.parent_origin==="undefined")d.parent_origin=b.origin;if(b.origin===d.parent_origin){var c=b.data.slice(0,8),e=b.data.slice(8,9),b=b.data.slice(9);if(c===I)switch(e){case "s":var h=JSON.parse(b),c=h[0],e=h[1],b=h[2],i=h[3],h=h[4];c!==f.version&&d.log("Incompatibile SockJS! Main site uses: "+c+", the iframe: "+f.version+". Double check SockJS urls and flush browser cache.");
if(!d.flatUrl(b)||!d.flatUrl(i)){d.log("Only basic urls are supported in SockJS");break}if(!d.isSameOriginUrl(b)||!d.isSameOriginUrl(i)){d.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([g.location.href,b,i])+")");break}a=new u(h);a._transport=new u[e](a,b,i);break;case "m":a._doSend(b);break;case "c":a&&a._doCleanup(),a=null}}}});J("s")};var A=function(a,b){var c=this;d.delay(function(){c.doXhr(a,b)})};A.prototype=new k(["finish"]);A.prototype.doXhr=function(a,b){var c=
this,e=(new Date).getTime(),h=new b("GET",a+"/info"),f=d.delay(8E3,function(){h.ontimeout()});h.onfinish=function(a,b){clearTimeout(f);f=null;if(a===200){var d=(new Date).getTime()-e,h=JSON.parse(b);typeof h!=="object"&&(h={});c.emit("finish",h,d)}else c.emit("finish")};h.ontimeout=function(){h.close();c.emit("finish")}};var M=function(a,b){var c=this,e=function(){var e=new r;e.protocol="w-iframe-info-receiver";var d=function(a){typeof a==="string"&&a.substr(0,1)==="m"?(a=JSON.parse(a.substr(1)),
c.emit("finish",a[0],a[1])):c.emit("finish");e.doCleanup();e=null};e.i_constructor({_options:{js_path:a._options.js_path},_didClose:d,_didMessage:d},b,b)};m.body?e():d.attachEvent("load",e)};M.prototype=new k(["finish"]);var N=function(){var a=this;d.delay(function(){a.emit("finish",{},2E3)})};N.prototype=new k(["finish"]);var P=function(a,b){if(d.isSameOriginUrl(b))return new A(b,d.XHRLocalObject);switch(d.isXHRCorsCapable(b)){case 1:return new A(b,d.XHRLocalObject);case 2:return new A(b,d.XDRObject);
case 3:return new M(a,b);default:return new N}};(u["w-iframe-info-receiver"]=function(a,b,c){(new A(c,d.XHRLocalObject)).onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c]));a._didClose(void 0,void 0,void 0,"w-iframe-info-receiver")}}).prototype.doCleanup=function(){};n=f["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource";this.i_constructor.apply(this,arguments)};n.prototype=new r;n.enabled=function(){return"EventSource"in g&&r.enabled()};n.need_body=!0;n.roundTrips=
3;(u["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",K,d.XHRLocalObject)}).prototype=new i;n=f["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling";this.i_constructor.apply(this,arguments)};n.prototype=new r;n.enabled=function(){return g.XMLHttpRequest&&r.enabled()};n.need_body=!0;n.roundTrips=3;(u["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",y,d.XHRLocalObject)}).prototype=new i;n=f["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile";this.i_constructor.apply(this,
arguments)};n.prototype=new r;n.enabled=function(){return r.enabled()};n.need_body=!0;n.roundTrips=3;(u["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",L,d.XHRLocalObject)}).prototype=new i;var H=function(a,b,c,e){this.ri=a;this.Receiver=b;this.recv_url=c;this.AjaxObject=e;this._scheduleRecv()};H.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject),c=0;b.onmessage=function(b){c+=1;a.ri._didMessage(b.data)};b.onclose=function(c){var e;a.poll=(e=
b.onmessage=b.onclose=null,b=e);a.poll_is_closing||(c.reason==="permanent"?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}};H.prototype.abort=function(){this.poll_is_closing=!0;this.poll&&this.poll.abort()};var K=function(a){var b=this,c=new EventSource(a);c.onmessage=function(a){b.dispatchEvent(new l("message",{data:unescape(a.data)}))};b.es_close=c.onerror=function(a,f){var g=f?"user":c.readyState!==2?"network":"permanent";b.es_close=c.onmessage=c.onerror=null;c.close();
c=null;d.delay(200,function(){b.dispatchEvent(new l("close",{reason:g}))})}};K.prototype=new p;K.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var D,L=function(a){var b=this;d.polluteGlobalNamespace();b.id="a"+d.random_string(6,26);a+=(a.indexOf("?")===-1?"?":"&")+"c="+escape("_jp."+b.id);if(D===void 0)if("ActiveXObject"in g)try{D=!!new ActiveXObject("htmlfile")}catch(c){}else D=!1;var e=D?d.createHtmlfile:d.createIframe,f;g._jp[b.id]={start:function(){f.loaded()},message:function(a){b.dispatchEvent(new l("message",
{data:a}))},stop:function(){b.iframe_close({},"network")}};b.iframe_close=function(a,c){f.cleanup();b.iframe_close=f=null;delete g._jp[b.id];b.dispatchEvent(new l("close",{reason:c}))};f=e(a,function(){b.iframe_close({},"permanent")})};L.prototype=new p;L.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var y=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null);c.xo.onchunk=function(a,b){if(a===200)for(;;){var f=b.slice(d),g=f.indexOf("\n");if(g===-1)break;d+=g+1;f=f.slice(0,
g);c.dispatchEvent(new l("message",{data:f}))}};c.xo.onfinish=function(a,b){c.xo.onchunk(a,b);c.xo=null;c.dispatchEvent(new l("close",{reason:a===200?"network":"permanent"}))}};y.prototype=new p;y.prototype.abort=function(){if(this.xo)this.xo.close(),this.dispatchEvent(new l("close",{reason:"user"})),this.xo=null};f.getUtils=function(){return d};f.getIframeTransport=function(){return r};var B=function(a,b){var c=this;c.timeout=a;c.not_poked=0;c._onTimeout=function(){c.not_poked+=1;c.not_poked===b&&
c.emit("timeout");c._restartTimeout()};c._restartTimeout()};B.prototype=new k(["first","second","timeout"]);B.prototype.poke=function(){this.not_poked=0;this._restartTimeout()};B.prototype.close=function(){clearTimeout(this.tref)};B.prototype._restartTimeout=function(){this.tref&&clearTimeout(this.tref);this.tref=setTimeout(this._onTimeout,this.timeout)};f.prototype._startHeartbeats=function(a){var b=this;b._heartbeater=new B(a,2);b._bus.on("heartbeat",function(){f[b.protocol].polling||b._sendEmpty()});
b._heartbeater.ontimeout=function(){b._didClose(1007,"Server heartbeat missed")};a=function(){b._heartbeater.poke()};b._bus.on("heartbeat",a);b._bus.on("message",a);b._bus.on("close",function(){b._heartbeater.nuke();b._heartbeater.close()})};return f}();"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1);typeof define==="function"&&define.amd&&define("sockjs",[],function(){return SockJS});if(typeof module==="object"&&module&&module.exports)module.exports=SockJS;
