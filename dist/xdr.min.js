/*!
 * Pusher JavaScript Library v3.0.0
 * http://pusher.com/
 *
 * Copyright 2014, Pusher
 * Released under the MIT licence.
 */

(function(){function d(a,c,d){Pusher.EventsDispatcher.call(this);this.hooks=a;this.method=c;this.url=d}var a=d.prototype;Pusher.Util.extend(a,Pusher.EventsDispatcher.prototype);a.start=function(a){var c=this;c.position=0;c.xhr=c.hooks.getRequest(c);c.unloader=function(){c.close()};Pusher.Util.addWindowListener("unload",c.unloader);c.xhr.open(c.method,c.url,!0);c.xhr.send(a)};a.close=function(){this.unloader&&(Pusher.Util.removeWindowListener("unload",this.unloader),this.unloader=null);this.xhr&&(this.hooks.abortRequest(this.xhr),
this.xhr=null)};a.onChunk=function(a,c){for(;;){var d=this.advanceBuffer(c);if(d)this.emit("chunk",{status:a,data:d});else break}this.isBufferTooLong(c)&&this.emit("buffer_too_long")};a.advanceBuffer=function(a){a=a.slice(this.position);var c=a.indexOf("\n");return-1!==c?(this.position+=c+1,a.slice(0,c)):null};a.isBufferTooLong=function(a){return this.position===a.length&&262144<a.length};Pusher.HTTP.Request=d}).call(this);
(function(){var d={getRequest:function(a){var b=new window.XDomainRequest;b.ontimeout=function(){a.emit("error",new Pusher.Errors.RequestTimedOut);a.close()};b.onerror=function(b){a.emit("error",b);a.close()};b.onprogress=function(){if(b.responseText&&0<b.responseText.length)a.onChunk(200,b.responseText)};b.onload=function(){if(b.responseText&&0<b.responseText.length)a.onChunk(200,b.responseText);a.emit("finished",200);a.close()};return b},abortRequest:function(a){a.ontimeout=a.onerror=a.onprogress=
a.onload=null;a.abort()}};Pusher.HTTP.getXDR=function(a,b){return new Pusher.HTTP.Request(d,a,b)}}).call(this);
(function(){function d(a,b){this.hooks=a;var d=Math.floor(1E3*Math.random())+"/",e;e=[];for(var f=0;8>f;f++)e.push(Math.floor(32*Math.random()).toString(32));e=e.join("");this.session=d+e;d=/([^\?]*)\/*(\??.*)/.exec(b);this.location={base:d[1],queryString:d[2]};this.readyState=c;this.openStream()}function a(a){var b=-1===a.indexOf("?")?"?":"&";return a+b+"t="+ +new Date+"&n="+g++}function b(a,b){if(Pusher.Util.isXHRSupported())return Pusher.HTTP.getXHR(a,b);if(Pusher.Util.isXDRSupported(0===b.indexOf("https:")))return Pusher.HTTP.getXDR(a,
b);throw"Cross-origin HTTP requests are not supported";}var c=0,g=1,e=d.prototype;e.send=function(a){return this.sendRaw(JSON.stringify([a]))};e.ping=function(){this.hooks.sendHeartbeat(this)};e.close=function(a,b){this.onClose(a,b,!0)};e.sendRaw=function(h){if(1===this.readyState)try{return b("POST",a(this.location.base+"/"+this.session+"/xhr_send")).start(h),!0}catch(c){return!1}else return!1};e.reconnect=function(){this.closeStream();this.openStream()};e.onClose=function(a,b,c){this.closeStream();
this.readyState=3;if(this.onclose)this.onclose({code:a,reason:b,wasClean:c})};e.onChunk=function(a){if(200===a.status){if(1===this.readyState)this.onActivity();switch(a.data.slice(0,1)){case "o":a=JSON.parse(a.data.slice(1)||"{}");this.onOpen(a);break;case "a":a=JSON.parse(a.data.slice(1)||"[]");for(var b=0;b<a.length;b++)this.onEvent(a[b]);break;case "m":a=JSON.parse(a.data.slice(1)||"null");this.onEvent(a);break;case "h":this.hooks.onHeartbeat(this);break;case "c":a=JSON.parse(a.data.slice(1)||
"[]"),this.onClose(a[0],a[1],!0)}}};e.onOpen=function(a){if(this.readyState===c){if(a&&a.hostname){var b=this.location;a=a.hostname;var d=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(this.location.base);b.base=d[1]+a+d[3]}this.readyState=1;if(this.onopen)this.onopen()}else this.onClose(1006,"Server lost session",!0)};e.onEvent=function(a){if(1===this.readyState&&this.onmessage)this.onmessage({data:a})};e.onActivity=function(){if(this.onactivity)this.onactivity()};e.onError=function(a){if(this.onerror)this.onerror(a)};
e.openStream=function(){var c=this;c.stream=b("POST",a(c.hooks.getReceiveURL(c.location,c.session)));c.stream.bind("chunk",function(a){c.onChunk(a)});c.stream.bind("finished",function(a){c.hooks.onFinished(c,a)});c.stream.bind("buffer_too_long",function(){c.reconnect()});try{c.stream.start()}catch(d){Pusher.Util.defer(function(){c.onError(d);c.onClose(1006,"Could not start streaming",!1)})}};e.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)};Pusher.HTTP.Socket=
d}).call(this);(function(){var d={getReceiveURL:function(a,b){return a.base+"/"+b+"/xhr_streaming"+a.queryString},onHeartbeat:function(a){a.sendRaw("[]")},sendHeartbeat:function(a){a.sendRaw("[]")},onFinished:function(a,b){a.onClose(1006,"Connection interrupted ("+b+")",!1)}};Pusher.HTTP.getStreamingSocket=function(a){return new Pusher.HTTP.Socket(d,a)}}).call(this);
(function(){var d={getReceiveURL:function(a,b){return a.base+"/"+b+"/xhr"+a.queryString},onHeartbeat:function(){},sendHeartbeat:function(a){a.sendRaw("[]")},onFinished:function(a,b){if(200===b)a.reconnect();else a.onClose(1006,"Connection interrupted ("+b+")",!1)}};Pusher.HTTP.getPollingSocket=function(a){return new Pusher.HTTP.Socket(d,a)}}).call(this);
